<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MutenRos | Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --gbc-green-light: #9bbc0f;
            --gbc-green-mid: #8bac0f;
            --gbc-green-dark: #306230;
            --gbc-green-darkest: #0f380f;
            --tile-size: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Game Boy Color Frame */
        .gameboy-frame {
            background: linear-gradient(145deg, #8b5cf6, #6d28d9);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .screen-bezel {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #333;
        }

        /* Main Game Screen */
        #game-container {
            width: 480px;
            height: 432px;
            background-color: var(--gbc-green-light);
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
            border: 4px solid var(--gbc-green-darkest);
        }

        /* Intro Screen */
        #intro-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--gbc-green-light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }

        #intro-screen h1 {
            color: var(--gbc-green-darkest);
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        #intro-screen p {
            color: var(--gbc-green-dark);
            font-size: 0.6rem;
            margin-bottom: 15px;
        }

        .press-start {
            color: var(--gbc-green-darkest);
            font-size: 0.7rem;
            animation: blink 1s infinite;
            margin-top: 30px;
            cursor: pointer;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Game World */
        #game-world {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
        }

        #map {
            position: absolute;
            background-color: var(--gbc-green-mid);
        }

        /* Tile base */
        .tile {
            position: absolute;
            width: var(--tile-size);
            height: var(--tile-size);
            image-rendering: pixelated;
        }

        /* Grass tile with pattern */
        .grass {
            background: var(--gbc-green-mid);
        }
        .grass::before {
            content: '';
            position: absolute;
            width: 6px; height: 8px;
            left: 4px; top: 6px;
            background: var(--gbc-green-dark);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
        }
        .grass::after {
            content: '';
            position: absolute;
            width: 6px; height: 8px;
            right: 6px; bottom: 8px;
            background: var(--gbc-green-dark);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
        }

        /* Tall grass (encounters) */
        .tall-grass {
            background: var(--gbc-green-dark);
        }
        .tall-grass::before, .tall-grass::after {
            content: '';
            position: absolute;
            width: 4px; height: 12px;
            background: var(--gbc-green-darkest);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
        }
        .tall-grass::before { left: 6px; top: 2px; }
        .tall-grass::after { right: 6px; top: 4px; }

        /* Path/Road */
        .path {
            background: #c8b896;
            border: 1px solid #a89878;
        }

        /* Tree tile */
        .tree {
            background: var(--gbc-green-mid);
        }
        .tree::before {
            content: '';
            position: absolute;
            width: 24px; height: 18px;
            left: 4px; top: 2px;
            background: var(--gbc-green-dark);
            border-radius: 50% 50% 40% 40%;
            border: 2px solid var(--gbc-green-darkest);
        }
        .tree::after {
            content: '';
            position: absolute;
            width: 8px; height: 10px;
            left: 12px; bottom: 0;
            background: #604020;
            border: 1px solid var(--gbc-green-darkest);
        }

        /* Water tile */
        .water {
            background: #3080c0;
            animation: water-anim 1s infinite;
        }
        .water::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent 0%, #60a0e0 50%, transparent 100%);
            animation: wave 2s infinite linear;
        }
        @keyframes water-anim {
            0%, 100% { background: #3080c0; }
            50% { background: #4090d0; }
        }
        @keyframes wave {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Flower tile */
        .flower {
            background: var(--gbc-green-mid);
        }
        .flower::before {
            content: '';
            position: absolute;
            width: 8px; height: 8px;
            left: 6px; top: 10px;
            background: #f04040;
            border-radius: 50%;
            box-shadow: 14px 4px 0 #f0f040, 6px -6px 0 #f0f040;
        }

        /* House/Building */
        .house {
            background: #d04040;
            border: 2px solid var(--gbc-green-darkest);
        }
        .house::before {
            content: '';
            position: absolute;
            width: 0; height: 0;
            left: 0; top: -10px;
            border-left: 16px solid transparent;
            border-right: 16px solid transparent;
            border-bottom: 12px solid #802020;
        }
        .house::after {
            content: '';
            position: absolute;
            width: 10px; height: 12px;
            left: 11px; bottom: 0;
            background: #604020;
            border: 1px solid var(--gbc-green-darkest);
        }

        /* Fence */
        .fence {
            background: var(--gbc-green-mid);
        }
        .fence::before {
            content: '';
            position: absolute;
            width: 100%; height: 16px;
            left: 0; top: 8px;
            background: repeating-linear-gradient(90deg, #c0a080 0px, #c0a080 4px, #a08060 4px, #a08060 6px, #c0a080 6px, #c0a080 10px);
            border-top: 2px solid #806040;
            border-bottom: 2px solid #806040;
        }

        /* Sign post */
        .sign {
            background: var(--gbc-green-mid);
        }
        .sign::before {
            content: '';
            position: absolute;
            width: 20px; height: 14px;
            left: 6px; top: 4px;
            background: #c0a080;
            border: 2px solid #604020;
        }
        .sign::after {
            content: '';
            position: absolute;
            width: 4px; height: 12px;
            left: 14px; bottom: 0;
            background: #604020;
        }

        /* House roof (top part) */
        .house-roof {
            background: #c04040;
        }
        .house-roof::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #e06060 0%, #a02020 100%);
            border-bottom: 3px solid #801010;
        }

        /* House wall */
        .house-wall {
            background: #e8d8c0;
            border: 2px solid #a08060;
        }

        /* House door (entrada) */
        .house-door {
            background: #e8d8c0;
            border: 2px solid #a08060;
            cursor: pointer;
        }
        .house-door::before {
            content: '';
            position: absolute;
            width: 16px; height: 24px;
            left: 8px; top: 4px;
            background: #604020;
            border: 2px solid #402010;
        }
        .house-door::after {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            left: 20px; top: 14px;
            background: #f0d020;
            border-radius: 50%;
        }

        /* Interior tiles */
        .floor {
            background: #d0c0a0;
            border: 1px solid #b0a080;
        }
        .interior-wall {
            background: #a08060;
            border: 2px solid #604020;
        }
        .carpet {
            background: #c04040;
            border: 1px solid #a02020;
        }
        .table {
            background: #d0c0a0;
        }
        .table::before {
            content: '';
            position: absolute;
            width: 24px; height: 20px;
            left: 4px; top: 6px;
            background: #805030;
            border: 2px solid #603010;
        }
        .bookshelf {
            background: #a08060;
        }
        .bookshelf::before {
            content: '';
            position: absolute;
            width: 28px; height: 28px;
            left: 2px; top: 2px;
            background: #604020;
            border: 2px solid #402010;
        }
        .bookshelf::after {
            content: '';
            position: absolute;
            width: 24px; height: 6px;
            left: 4px; top: 6px;
            background: linear-gradient(90deg, #d04040 0%, #40a040 33%, #4040d0 66%, #d0d040 100%);
            box-shadow: 0 8px 0 linear-gradient(90deg, #40a040, #d04040, #d0d040, #4040d0);
        }
        .exit-mat {
            background: #d0c0a0;
        }
        .exit-mat::before {
            content: '';
            position: absolute;
            width: 24px; height: 8px;
            left: 4px; top: 20px;
            background: #c04040;
            border: 1px solid #802020;
        }

        /* NPC name label */
        .npc-label {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gbc-green-darkest);
            color: var(--gbc-green-light);
            padding: 2px 6px;
            font-size: 0.4rem;
            white-space: nowrap;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .npc.nearby .npc-label {
            opacity: 1;
        }

        /* House label */
        .house-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gbc-green-darkest);
            color: var(--gbc-green-light);
            padding: 3px 8px;
            font-size: 0.35rem;
            white-space: nowrap;
            border-radius: 3px;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .house-label.visible {
            opacity: 1;
        }

        /* Player Sprite - Pixel Art */
        #player {
            position: absolute;
            width: var(--tile-size);
            height: var(--tile-size);
            z-index: 50;
            image-rendering: pixelated;
        }

        .sprite {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Player sprite using CSS pixel art - Frame 1 (standing/left foot) */
        .player-sprite {
            width: 100%; height: 100%;
            position: relative;
        }
        .player-sprite::before {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            background: transparent;
            box-shadow:
                /* Hair */
                8px 0 #0f380f, 12px 0 #0f380f, 16px 0 #0f380f, 20px 0 #0f380f,
                4px 4px #0f380f, 8px 4px #0f380f, 12px 4px #0f380f, 16px 4px #0f380f, 20px 4px #0f380f, 24px 4px #0f380f,
                /* Face */
                4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                /* Body */
                4px 20px #3050a0, 8px 20px #3050a0, 12px 20px #6080c0, 16px 20px #6080c0, 20px 20px #3050a0, 24px 20px #3050a0,
                4px 24px #3050a0, 8px 24px #6080c0, 12px 24px #6080c0, 16px 24px #6080c0, 20px 24px #6080c0, 24px 24px #3050a0,
                /* Legs - standing */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f;
        }
        
        /* Walk animation - alternating leg positions */
        @keyframes walk-legs {
            0%, 100% { 
                box-shadow:
                    8px 0 #0f380f, 12px 0 #0f380f, 16px 0 #0f380f, 20px 0 #0f380f,
                    4px 4px #0f380f, 8px 4px #0f380f, 12px 4px #0f380f, 16px 4px #0f380f, 20px 4px #0f380f, 24px 4px #0f380f,
                    4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                    4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                    8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                    4px 20px #3050a0, 8px 20px #3050a0, 12px 20px #6080c0, 16px 20px #6080c0, 20px 20px #3050a0, 24px 20px #3050a0,
                    4px 24px #3050a0, 8px 24px #6080c0, 12px 24px #6080c0, 16px 24px #6080c0, 20px 24px #6080c0, 24px 24px #3050a0,
                    /* Left leg forward */
                    4px 28px #0f380f, 8px 28px #306230, 20px 28px #306230, 24px 28px #0f380f;
            }
            50% { 
                box-shadow:
                    8px 0 #0f380f, 12px 0 #0f380f, 16px 0 #0f380f, 20px 0 #0f380f,
                    4px 4px #0f380f, 8px 4px #0f380f, 12px 4px #0f380f, 16px 4px #0f380f, 20px 4px #0f380f, 24px 4px #0f380f,
                    4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                    4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                    8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                    4px 20px #3050a0, 8px 20px #3050a0, 12px 20px #6080c0, 16px 20px #6080c0, 20px 20px #3050a0, 24px 20px #3050a0,
                    4px 24px #3050a0, 8px 24px #6080c0, 12px 24px #6080c0, 16px 24px #6080c0, 20px 24px #6080c0, 24px 24px #3050a0,
                    /* Right leg forward */
                    8px 28px #306230, 12px 28px #0f380f, 16px 28px #0f380f, 20px 28px #306230;
            }
        }
        
        #player.walking .player-sprite::before {
            animation: walk-legs 0.25s steps(2) infinite;
        }

        /* NPC Sprites (Projects) - Pixel Art */
        .npc {
            position: absolute;
            width: var(--tile-size);
            height: var(--tile-size);
            cursor: pointer;
            z-index: 40;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* NPC Person sprites - different colors */
        .npc-sprite {
            width: 100%; height: 100%;
            position: relative;
        }
        .npc-sprite::before {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            background: transparent;
            box-shadow:
                /* Hair - Red */
                8px 0 #a02020, 12px 0 #a02020, 16px 0 #a02020, 20px 0 #a02020,
                4px 4px #c04040, 8px 4px #c04040, 12px 4px #c04040, 16px 4px #c04040, 20px 4px #c04040, 24px 4px #a02020,
                /* Face */
                4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                /* Body - Red shirt */
                4px 20px #c04040, 8px 20px #c04040, 12px 20px #e06060, 16px 20px #e06060, 20px 20px #c04040, 24px 20px #c04040,
                4px 24px #c04040, 8px 24px #e06060, 12px 24px #e06060, 16px 24px #e06060, 20px 24px #e06060, 24px 24px #c04040,
                /* Legs */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f;
        }

        .npc-sprite-blue {
            width: 100%; height: 100%;
            position: relative;
        }
        .npc-sprite-blue::before {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            background: transparent;
            box-shadow:
                /* Hair - Brown */
                8px 0 #604020, 12px 0 #604020, 16px 0 #604020, 20px 0 #604020,
                4px 4px #805030, 8px 4px #805030, 12px 4px #805030, 16px 4px #805030, 20px 4px #805030, 24px 4px #604020,
                /* Face */
                4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                /* Body - Blue shirt */
                4px 20px #2050a0, 8px 20px #2050a0, 12px 20px #4080d0, 16px 20px #4080d0, 20px 20px #2050a0, 24px 20px #2050a0,
                4px 24px #2050a0, 8px 24px #4080d0, 12px 24px #4080d0, 16px 24px #4080d0, 20px 24px #4080d0, 24px 24px #2050a0,
                /* Legs */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f;
        }

        .npc-sprite-green {
            width: 100%; height: 100%;
            position: relative;
        }
        .npc-sprite-green::before {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            background: transparent;
            box-shadow:
                /* Hair - Blonde */
                8px 0 #c0a020, 12px 0 #c0a020, 16px 0 #c0a020, 20px 0 #c0a020,
                4px 4px #e0c040, 8px 4px #e0c040, 12px 4px #e0c040, 16px 4px #e0c040, 20px 4px #e0c040, 24px 4px #c0a020,
                /* Face */
                4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                /* Body - Green shirt */
                4px 20px #208040, 8px 20px #208040, 12px 20px #40a060, 16px 20px #40a060, 20px 20px #208040, 24px 20px #208040,
                4px 24px #208040, 8px 24px #40a060, 12px 24px #40a060, 16px 24px #40a060, 20px 24px #40a060, 24px 24px #208040,
                /* Legs */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f;
        }

        .npc-sprite-purple {
            width: 100%; height: 100%;
            position: relative;
        }
        .npc-sprite-purple::before {
            content: '';
            position: absolute;
            width: 4px; height: 4px;
            background: transparent;
            box-shadow:
                /* Hair - Black */
                8px 0 #202020, 12px 0 #202020, 16px 0 #202020, 20px 0 #202020,
                4px 4px #303030, 8px 4px #303030, 12px 4px #303030, 16px 4px #303030, 20px 4px #303030, 24px 4px #202020,
                /* Face */
                4px 8px #e8c090, 8px 8px #e8c090, 12px 8px #e8c090, 16px 8px #e8c090, 20px 8px #e8c090, 24px 8px #e8c090,
                4px 12px #e8c090, 8px 12px #0f380f, 12px 12px #e8c090, 16px 12px #e8c090, 20px 12px #0f380f, 24px 12px #e8c090,
                8px 16px #e8c090, 12px 16px #e8c090, 16px 16px #e8c090, 20px 16px #e8c090,
                /* Body - Purple shirt */
                4px 20px #602080, 8px 20px #602080, 12px 20px #8040a0, 16px 20px #8040a0, 20px 20px #602080, 24px 20px #602080,
                4px 24px #602080, 8px 24px #8040a0, 12px 24px #8040a0, 16px 24px #8040a0, 20px 24px #8040a0, 24px 24px #602080,
                /* Legs */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f;
        }

        /* Dialog Box */
        #dialog-box {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: white;
            border-top: 4px solid var(--gbc-green-darkest);
            padding: 15px;
            display: none;
            z-index: 200;
        }

        #dialog-text {
            color: var(--gbc-green-darkest);
            font-size: 0.6rem;
            line-height: 1.8;
        }

        #dialog-continue {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 0.5rem;
            color: var(--gbc-green-dark);
            animation: blink 0.8s infinite;
        }

        /* Battle Screen */
        #battle-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            display: none;
            flex-direction: column;
            z-index: 300;
        }

        .battle-top {
            height: 50%;
            background: linear-gradient(to bottom, #87ceeb 0%, #87ceeb 60%, var(--gbc-green-mid) 60%);
            position: relative;
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            padding: 20px;
        }

        .enemy-pokemon {
            text-align: center;
        }

        .enemy-sprite {
            width: 96px;
            height: 96px;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: enemy-appear 0.5s ease-out;
        }

        /* Pokemon-style monster sprite */
        .monster-sprite {
            background: transparent;
            box-shadow:
                /* Head */
                16px 0 #306230, 20px 0 #306230, 24px 0 #306230, 28px 0 #306230,
                12px 4px #306230, 16px 4px #9bbc0f, 20px 4px #9bbc0f, 24px 4px #9bbc0f, 28px 4px #9bbc0f, 32px 4px #306230,
                8px 8px #306230, 12px 8px #9bbc0f, 16px 8px #9bbc0f, 20px 8px #0f380f, 24px 8px #9bbc0f, 28px 8px #0f380f, 32px 8px #9bbc0f, 36px 8px #306230,
                8px 12px #306230, 12px 12px #9bbc0f, 16px 12px #9bbc0f, 20px 12px #9bbc0f, 24px 12px #9bbc0f, 28px 12px #9bbc0f, 32px 12px #9bbc0f, 36px 12px #306230,
                8px 16px #306230, 12px 16px #9bbc0f, 16px 16px #9bbc0f, 20px 16px #8bac0f, 24px 16px #8bac0f, 28px 16px #9bbc0f, 32px 16px #9bbc0f, 36px 16px #306230,
                /* Body */
                4px 20px #306230, 8px 20px #9bbc0f, 12px 20px #9bbc0f, 16px 20px #9bbc0f, 20px 20px #9bbc0f, 24px 20px #9bbc0f, 28px 20px #9bbc0f, 32px 20px #9bbc0f, 36px 20px #9bbc0f, 40px 20px #306230,
                4px 24px #306230, 8px 24px #8bac0f, 12px 24px #9bbc0f, 16px 24px #9bbc0f, 20px 24px #9bbc0f, 24px 24px #9bbc0f, 28px 24px #9bbc0f, 32px 24px #9bbc0f, 36px 24px #8bac0f, 40px 24px #306230,
                8px 28px #306230, 12px 28px #8bac0f, 16px 28px #9bbc0f, 20px 28px #9bbc0f, 24px 28px #9bbc0f, 28px 28px #9bbc0f, 32px 28px #8bac0f, 36px 28px #306230,
                /* Feet */
                8px 32px #306230, 12px 32px #306230, 16px 32px #306230, 28px 32px #306230, 32px 32px #306230, 36px 32px #306230,
                8px 36px #306230, 12px 36px #306230, 32px 36px #306230, 36px 36px #306230;
            width: 4px;
            height: 4px;
            transform: scale(2);
        }

        @keyframes enemy-appear {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .enemy-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #f8f8f8;
            border: 3px solid var(--gbc-green-darkest);
            padding: 10px;
            min-width: 180px;
        }

        .enemy-name {
            font-size: 0.7rem;
            color: var(--gbc-green-darkest);
            margin-bottom: 5px;
        }

        .enemy-level {
            font-size: 0.5rem;
            color: var(--gbc-green-dark);
        }

        .hp-bar {
            margin-top: 8px;
            height: 8px;
            background: var(--gbc-green-darkest);
            border-radius: 4px;
            overflow: hidden;
        }

        .hp-fill {
            height: 100%;
            background: var(--gbc-green-light);
            width: 100%;
        }

        .battle-bottom {
            height: 50%;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .player-pokemon-area {
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .player-battle-sprite {
            width: 64px;
            height: 64px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Trainer back sprite */
        .trainer-sprite {
            background: transparent;
            box-shadow:
                /* Hair */
                8px 0 #0f380f, 12px 0 #0f380f, 16px 0 #0f380f, 20px 0 #0f380f,
                4px 4px #0f380f, 8px 4px #0f380f, 12px 4px #0f380f, 16px 4px #0f380f, 20px 4px #0f380f, 24px 4px #0f380f,
                4px 8px #0f380f, 8px 8px #0f380f, 12px 8px #0f380f, 16px 8px #0f380f, 20px 8px #0f380f, 24px 8px #0f380f,
                /* Back/Jacket */
                4px 12px #3050a0, 8px 12px #4070c0, 12px 12px #4070c0, 16px 12px #4070c0, 20px 12px #4070c0, 24px 12px #3050a0,
                0 16px #3050a0, 4px 16px #3050a0, 8px 16px #4070c0, 12px 16px #4070c0, 16px 16px #4070c0, 20px 16px #4070c0, 24px 16px #3050a0, 28px 16px #3050a0,
                0 20px #3050a0, 4px 20px #4070c0, 8px 20px #4070c0, 12px 20px #4070c0, 16px 20px #4070c0, 20px 20px #4070c0, 24px 20px #4070c0, 28px 20px #3050a0,
                4px 24px #3050a0, 8px 24px #4070c0, 12px 24px #4070c0, 16px 24px #4070c0, 20px 24px #4070c0, 24px 24px #3050a0,
                /* Pants */
                8px 28px #0f380f, 12px 28px #306230, 16px 28px #306230, 20px 28px #0f380f,
                8px 32px #0f380f, 12px 32px #0f380f, 16px 32px #0f380f, 20px 32px #0f380f;
            width: 4px;
            height: 4px;
            transform: scale(1.8);
        }

        .player-info {
            background: #f8f8f8;
            border: 3px solid var(--gbc-green-darkest);
            padding: 10px;
            min-width: 180px;
            text-align: right;
        }

        .battle-menu {
            height: 40%;
            border-top: 4px solid var(--gbc-green-darkest);
            display: grid;
            grid-template-columns: 1fr 1fr;
            padding: 10px;
            gap: 10px;
        }

        .battle-option {
            background: white;
            border: 2px solid var(--gbc-green-darkest);
            font-family: inherit;
            font-size: 0.6rem;
            color: var(--gbc-green-darkest);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .battle-option:hover, .battle-option.selected {
            background: var(--gbc-green-light);
            outline: 3px solid var(--gbc-green-darkest);
        }

        /* Info Panel (README display) */
        #info-panel {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            display: none;
            flex-direction: column;
            z-index: 350;
            overflow-y: auto;
        }

        .info-header {
            background: var(--gbc-green-dark);
            color: var(--gbc-green-light);
            padding: 15px;
            font-size: 0.7rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-content {
            padding: 15px;
            font-size: 0.5rem;
            line-height: 2;
            color: var(--gbc-green-darkest);
            flex: 1;
            overflow-y: auto;
        }

        .info-content a {
            color: var(--gbc-green-dark);
        }

        .back-btn {
            background: var(--gbc-green-light);
            border: none;
            padding: 8px 15px;
            font-family: inherit;
            font-size: 0.5rem;
            cursor: pointer;
            color: var(--gbc-green-darkest);
        }

        /* Controls hint */
        .controls-hint {
            text-align: center;
            margin-top: 15px;
            color: #888;
            font-size: 0.5rem;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            margin-top: 15px;
            justify-content: center;
            gap: 5px;
        }

        .dpad {
            display: grid;
            grid-template-columns: repeat(3, 40px);
            grid-template-rows: repeat(3, 40px);
            gap: 2px;
        }

        .dpad-btn {
            background: #333;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .dpad-btn:active {
            background: #555;
        }

        .dpad-center {
            background: #222;
            border-radius: 50%;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-left: 30px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-family: inherit;
            font-size: 0.5rem;
            cursor: pointer;
        }

        .btn-a {
            background: #dc2626;
            color: white;
        }

        .btn-b {
            background: #dc2626;
            color: white;
        }

        @media (max-width: 600px) {
            .gameboy-frame {
                padding: 10px;
                border-radius: 10px;
            }

            #game-container {
                width: 320px;
                height: 288px;
            }

            :root {
                --tile-size: 24px;
            }

            .mobile-controls {
                display: flex;
            }

            .enemy-sprite {
                font-size: 50px;
            }

            .player-sprite {
                font-size: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="gameboy-frame">
        <div class="screen-bezel">
            <div id="game-container">
                <!-- Intro Screen -->
                <div id="intro-screen">
                    <h1>PORTFOLIO<br>QUEST</h1>
                    <p>Por Dario Lacal Civera</p>
                    <p>Versión 1.0</p>
                    <div class="press-start" id="start-btn">PRESS START</div>
                </div>

                <!-- Game World -->
                <div id="game-world">
                    <div id="map"></div>
                    <div id="player">
                        <div class="player-sprite"></div>
                    </div>
                </div>

                <!-- Dialog Box -->
                <div id="dialog-box">
                    <div id="dialog-text"></div>
                    <div id="dialog-continue">▼ SPACE</div>
                </div>

                <!-- Battle Screen -->
                <div id="battle-screen">
                    <div class="battle-top">
                        <div class="enemy-info">
                            <div class="enemy-name" id="battle-enemy-name">PROYECTO</div>
                            <div class="enemy-level" id="battle-enemy-level">Lv.99</div>
                            <div class="hp-bar"><div class="hp-fill"></div></div>
                        </div>
                        <div class="enemy-pokemon">
                        <div class="enemy-sprite" id="battle-enemy-sprite">
                            <div class="monster-sprite"></div>
                        </div>
                    </div>
                    </div>
                    <div class="battle-bottom">
                        <div class="player-pokemon-area">
                            <div class="player-battle-sprite">
                                <div class="trainer-sprite"></div>
                            </div>
                            <div class="player-info">
                                <div class="enemy-name">MUTENROS</div>
                                <div class="enemy-level">Lv.∞</div>
                                <div class="hp-bar"><div class="hp-fill"></div></div>
                            </div>
                        </div>
                        <div class="battle-menu">
                            <button class="battle-option selected" id="btn-info">▶ INFO</button>
                            <button class="battle-option" id="btn-github">  GITHUB</button>
                            <button class="battle-option" id="btn-stats">  STATS</button>
                            <button class="battle-option" id="btn-run">  HUIR</button>
                        </div>
                    </div>
                </div>

                <!-- Info Panel -->
                <div id="info-panel">
                    <div class="info-header">
                        <span id="info-title">README.md</span>
                        <button class="back-btn" id="info-back">[X] CERRAR</button>
                    </div>
                    <div class="info-content" id="info-content">
                        Cargando...
                    </div>
                </div>
            </div>
        </div>
        <div class="controls-hint">
            ← ↑ ↓ → para moverse | ENTER para interactuar | ESC para volver
        </div>
        <div class="mobile-controls" style="display:none;">
            <div class="dpad">
                <div></div>
                <button class="dpad-btn" id="btn-up">▲</button>
                <div></div>
                <button class="dpad-btn" id="btn-left">◄</button>
                <div class="dpad-center"></div>
                <button class="dpad-btn" id="btn-right">►</button>
                <div></div>
                <button class="dpad-btn" id="btn-down">▼</button>
                <div></div>
            </div>
            <div class="action-buttons">
                <button class="action-btn btn-a" id="btn-action">A</button>
                <button class="action-btn btn-b" id="btn-cancel">B</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // ============== GAME STATE ==============
        const TILE_SIZE = 32;
        
        let playerX = 15;
        let playerY = 15;
        let cameraX = 0;
        let cameraY = 0;
        let npcs = [];
        let houses = [];
        let currentNpc = null;
        let currentHouse = null;
        let gameState = 'intro'; // intro, walking, dialog, battle, info
        let currentLocation = 'outside'; // outside, inside
        let isMoving = false;
        
        // DOM Elements
        const introScreen = document.getElementById('intro-screen');
        const gameWorld = document.getElementById('game-world');
        const map = document.getElementById('map');
        const player = document.getElementById('player');
        const dialogBox = document.getElementById('dialog-box');
        const dialogText = document.getElementById('dialog-text');
        const battleScreen = document.getElementById('battle-screen');
        const infoPanel = document.getElementById('info-panel');

        // ============== INIT ==============
        document.getElementById('start-btn').addEventListener('click', startGame);
        document.addEventListener('keydown', handleKeyDown);

        async function startGame() {
            introScreen.style.display = 'none';
            gameWorld.style.display = 'block';
            gameState = 'walking';
            
            await loadReposAndGenerateMap();
            updateCamera();
        }

        // ============== PROCEDURAL MAP GENERATION ==============
        // Tile types: 0=grass, 1=path, 2=tree, 3=water, 4=tall-grass, 5=flower, 6=fence, 7=sign
        // 10=house-roof, 11=house-wall, 12=house-door
        
        const TILE_TYPES = {
            0: 'grass', 1: 'path', 2: 'tree', 3: 'water', 4: 'tall-grass', 
            5: 'flower', 6: 'fence', 7: 'sign',
            10: 'house-roof', 11: 'house-wall', 12: 'house-door'
        };
        const SOLID_TILES = [2, 3, 6, 10, 11];
        
        // Interior map template (7x7)
        const INTERIOR_MAP = [
            [20,20,20,20,20,20,20],
            [20,22,21,21,21,23,20],
            [20,21,21,21,21,21,20],
            [20,21,21,24,21,21,20],
            [20,21,21,24,21,21,20],
            [20,21,21,25,21,21,20],
            [20,20,20,20,20,20,20]
        ];
        const INTERIOR_TYPES = {
            20: 'interior-wall', 21: 'floor', 22: 'bookshelf', 23: 'table', 24: 'carpet', 25: 'exit-mat'
        };
        const INTERIOR_SOLID = [20, 22, 23];
        
        // Dynamic map data - will be generated based on repos
        let MAP_DATA = [];
        let MAP_ROWS = 0;
        let MAP_COLS = 0;
        
        // Calculate map size based on number of houses
        function calculateMapSize(numHouses) {
            // Houses per row (3 houses per row with spacing)
            const housesPerRow = 3;
            const rowsNeeded = Math.ceil(numHouses / housesPerRow);
            
            // Each house block needs ~10 tiles width, 8 tiles height
            const blockWidth = 10;
            const blockHeight = 8;
            
            // Map dimensions with borders and paths
            const cols = Math.max(30, housesPerRow * blockWidth + 6);
            const rows = Math.max(20, rowsNeeded * blockHeight + 10);
            
            return { cols, rows, housesPerRow, blockWidth, blockHeight };
        }
        
        // Generate procedural map based on number of repos
        function generateProceduralMap(numHouses) {
            const { cols, rows, housesPerRow, blockWidth, blockHeight } = calculateMapSize(numHouses);
            
            MAP_COLS = cols;
            MAP_ROWS = rows;
            MAP_DATA = [];
            
            // Initialize with grass
            for (let y = 0; y < rows; y++) {
                MAP_DATA[y] = [];
                for (let x = 0; x < cols; x++) {
                    MAP_DATA[y][x] = 0; // grass
                }
            }
            
            // Add tree border
            for (let x = 0; x < cols; x++) {
                MAP_DATA[0][x] = 2;
                MAP_DATA[rows - 1][x] = 2;
            }
            for (let y = 0; y < rows; y++) {
                MAP_DATA[y][0] = 2;
                MAP_DATA[y][cols - 1] = 2;
            }
            
            // Add some random trees on edges
            for (let y = 1; y < rows - 1; y++) {
                if (Math.random() < 0.3) MAP_DATA[y][1] = 2;
                if (Math.random() < 0.3) MAP_DATA[y][cols - 2] = 2;
            }
            
            // Main vertical path in center
            const mainPathX = Math.floor(cols / 2);
            for (let y = 3; y < rows - 3; y++) {
                MAP_DATA[y][mainPathX] = 1;
                MAP_DATA[y][mainPathX - 1] = 1;
            }
            
            // Generate house positions and horizontal paths
            const housePositions = [];
            const rowsOfHouses = Math.ceil(numHouses / housesPerRow);
            
            for (let row = 0; row < rowsOfHouses; row++) {
                const baseY = 4 + row * blockHeight;
                
                // Horizontal path for this row
                for (let x = 3; x < cols - 3; x++) {
                    if (baseY + 2 < rows - 1) {
                        MAP_DATA[baseY + 2][x] = 1;
                    }
                }
                
                // Houses in this row
                for (let col = 0; col < housesPerRow; col++) {
                    const houseIndex = row * housesPerRow + col;
                    if (houseIndex >= numHouses) break;
                    
                    // Calculate house position
                    let houseX;
                    if (col === 0) {
                        houseX = 4;
                    } else if (col === 1) {
                        houseX = mainPathX + 3;
                    } else {
                        houseX = cols - 8;
                    }
                    
                    const houseY = baseY - 1;
                    
                    // Place house (3x3: roof, walls, door)
                    if (houseY > 0 && houseY + 2 < rows - 1 && houseX + 2 < cols - 1) {
                        // Roof
                        MAP_DATA[houseY][houseX] = 10;
                        MAP_DATA[houseY][houseX + 1] = 10;
                        MAP_DATA[houseY][houseX + 2] = 10;
                        // Walls
                        MAP_DATA[houseY + 1][houseX] = 11;
                        MAP_DATA[houseY + 1][houseX + 1] = 11;
                        MAP_DATA[houseY + 1][houseX + 2] = 11;
                        // Door in center
                        MAP_DATA[houseY + 2][houseX] = 11;
                        MAP_DATA[houseY + 2][houseX + 1] = 12; // Door
                        MAP_DATA[houseY + 2][houseX + 2] = 11;
                        
                        // Path to door
                        MAP_DATA[houseY + 3][houseX + 1] = 1;
                        
                        housePositions.push({
                            doorX: houseX + 1,
                            doorY: houseY + 2
                        });
                    }
                }
            }
            
            // Add decorations
            for (let y = 2; y < rows - 2; y++) {
                for (let x = 2; x < cols - 2; x++) {
                    if (MAP_DATA[y][x] === 0) {
                        const rand = Math.random();
                        if (rand < 0.03) MAP_DATA[y][x] = 5; // flower
                        else if (rand < 0.05) MAP_DATA[y][x] = 4; // tall grass
                    }
                }
            }
            
            // Add water feature in corner if space
            if (rows > 15 && cols > 20) {
                const waterY = rows - 5;
                const waterX = cols - 8;
                for (let dy = 0; dy < 3; dy++) {
                    for (let dx = 0; dx < 4; dx++) {
                        if (MAP_DATA[waterY + dy] && MAP_DATA[waterY + dy][waterX + dx] === 0) {
                            MAP_DATA[waterY + dy][waterX + dx] = 3;
                        }
                    }
                }
            }
            
            // Set player start position
            playerX = mainPathX;
            playerY = Math.min(rows - 4, 6);
            
            return housePositions;
        }
        
        // Render the map
        function generateMap() {
            map.innerHTML = '';
            map.style.width = MAP_COLS * TILE_SIZE + 'px';
            map.style.height = MAP_ROWS * TILE_SIZE + 'px';

            for (let y = 0; y < MAP_ROWS; y++) {
                for (let x = 0; x < MAP_COLS; x++) {
                    const tileType = MAP_DATA[y][x];
                    const tile = document.createElement('div');
                    tile.className = 'tile ' + (TILE_TYPES[tileType] || 'grass');
                    tile.style.left = x * TILE_SIZE + 'px';
                    tile.style.top = y * TILE_SIZE + 'px';
                    map.appendChild(tile);
                }
            }
        }
        
        function generateInterior(house) {
            map.innerHTML = '';
            const rows = INTERIOR_MAP.length;
            const cols = INTERIOR_MAP[0].length;
            map.style.width = cols * TILE_SIZE + 'px';
            map.style.height = rows * TILE_SIZE + 'px';

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const tileType = INTERIOR_MAP[y][x];
                    const tile = document.createElement('div');
                    tile.className = 'tile ' + (INTERIOR_TYPES[tileType] || 'floor');
                    tile.style.left = x * TILE_SIZE + 'px';
                    tile.style.top = y * TILE_SIZE + 'px';
                    map.appendChild(tile);
                }
            }
            
            // Add NPC inside
            const npcData = {
                x: 3,
                y: 2,
                name: house.name,
                description: house.description,
                language: house.language,
                stars: house.stars,
                url: house.url,
                spriteClass: house.spriteClass
            };
            npcs = [npcData];
            renderNpc(npcData);
        }

        // ============== LOAD REPOS AND GENERATE MAP ==============
        async function loadReposAndGenerateMap() {
            const username = 'MutenRos';
            const spriteClasses = ['npc-sprite', 'npc-sprite-blue', 'npc-sprite-green', 'npc-sprite-purple'];
            
            try {
                // Fetch all repos (up to 100)
                const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
                if (!response.ok) throw new Error('API Error');
                
                const repos = await response.json();
                const numRepos = repos.length;
                
                // Generate procedural map based on number of repos
                const housePositions = generateProceduralMap(numRepos);
                
                // Render the map
                generateMap();
                
                // Create houses from repos
                repos.forEach((repo, index) => {
                    if (index >= housePositions.length) return;
                    
                    const pos = housePositions[index];
                    const house = {
                        doorX: pos.doorX,
                        doorY: pos.doorY,
                        name: repo.name,
                        description: repo.description || 'Sin descripcion',
                        language: repo.language || 'Unknown',
                        stars: repo.stargazers_count,
                        url: repo.html_url,
                        spriteClass: spriteClasses[index % spriteClasses.length]
                    };
                    
                    houses.push(house);
                    renderHouseLabel(house);
                });
                
                console.log(`Generated map with ${numRepos} houses (${MAP_COLS}x${MAP_ROWS} tiles)`);
                
            } catch (error) {
                console.error('Error loading repos:', error);
                // Generate minimal map with error message
                generateProceduralMap(1);
                generateMap();
            }
        }
        
        function renderHouseLabel(house) {
            const label = document.createElement('div');
            label.className = 'house-label';
            label.id = `label-${house.doorX}-${house.doorY}`;
            label.textContent = house.name;
            label.style.left = house.doorX * TILE_SIZE + 'px';
            label.style.top = (house.doorY - 1) * TILE_SIZE + 'px';
            map.appendChild(label);
        }

        function renderNpc(npc) {
            const npcEl = document.createElement('div');
            npcEl.className = 'npc';
            npcEl.id = `npc-${npc.x}-${npc.y}`;
            npcEl.style.left = npc.x * TILE_SIZE + 'px';
            npcEl.style.top = npc.y * TILE_SIZE + 'px';
            
            // Create pixel art sprite
            const spriteEl = document.createElement('div');
            spriteEl.className = npc.spriteClass;
            npcEl.appendChild(spriteEl);
            
            // Add name label
            const label = document.createElement('div');
            label.className = 'npc-label';
            label.textContent = npc.name;
            npcEl.appendChild(label);
            
            npcEl.dataset.name = npc.name;
            map.appendChild(npcEl);
        }

        // ============== PLAYER MOVEMENT ==============
        function handleKeyDown(e) {
            if (gameState === 'intro') {
                if (e.code === 'Space' || e.code === 'Enter') {
                    startGame();
                }
                return;
            }
            
            if (gameState === 'dialog') {
                if (e.code === 'Space' || e.code === 'Enter') {
                    startBattle(currentNpc);
                }
                if (e.code === 'Escape') {
                    dialogBox.style.display = 'none';
                    gameState = 'walking';
                }
                return;
            }
            
            if (gameState === 'battle') {
                // Arrow key navigation in battle menu
                handleBattleNavigation(e);
                return;
            }
            
            if (gameState === 'info') {
                if (e.code === 'Escape' || e.code === 'Enter') {
                    closeInfo();
                }
                return;
            }
            
            if (gameState !== 'walking' || isMoving) return;
            
            let newX = playerX;
            let newY = playerY;
            let moved = false;
            
            switch(e.code) {
                case 'ArrowUp':
                case 'KeyW':
                    newY--;
                    moved = true;
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    newY++;
                    moved = true;
                    break;
                case 'ArrowLeft':
                case 'KeyA':
                    newX--;
                    moved = true;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    newX++;
                    moved = true;
                    break;
                case 'Space':
                case 'Enter':
                    checkInteraction();
                    return;
            }
            
            if (!moved) return;
            e.preventDefault();
            
            // Handle interior movement
            if (currentLocation === 'inside') {
                const rows = INTERIOR_MAP.length;
                const cols = INTERIOR_MAP[0].length;
                if (newX < 0 || newX >= cols || newY < 0 || newY >= rows) return;
                
                const tileType = INTERIOR_MAP[newY][newX];
                if (INTERIOR_SOLID.includes(tileType)) return;
                
                // Check exit
                if (tileType === 25 && newY === 5) {
                    exitHouse();
                    return;
                }
                
                // Check NPC collision
                const npcAtPos = npcs.find(n => n.x === newX && n.y === newY);
                if (npcAtPos) return;
                
                movePlayer(newX, newY);
                updateNpcProximity();
                return;
            }
            
            // Handle outside movement
            if (newX < 0 || newX >= MAP_COLS || newY < 0 || newY >= MAP_ROWS) return;
            
            const tileType = MAP_DATA[newY][newX];
            
            // Check if entering a house door
            if (tileType === 12) {
                const house = houses.find(h => h.doorX === newX && h.doorY === newY);
                if (house) {
                    enterHouse(house);
                    return;
                }
            }
            
            if (SOLID_TILES.includes(tileType)) return;
            
            movePlayer(newX, newY);
            updateHouseLabels();
        }
        
        function movePlayer(newX, newY) {
            isMoving = true;
            playerX = newX;
            playerY = newY;
            
            player.classList.add('walking');
            
            updateCamera();
            
            setTimeout(() => {
                isMoving = false;
                player.classList.remove('walking');
            }, 150);
        }
        
        function updateHouseLabels() {
            houses.forEach(house => {
                const label = document.getElementById(`label-${house.doorX}-${house.doorY}`);
                if (label) {
                    const dist = Math.abs(playerX - house.doorX) + Math.abs(playerY - house.doorY);
                    if (dist <= 2) {
                        label.classList.add('visible');
                    } else {
                        label.classList.remove('visible');
                    }
                }
            });
        }
        
        function updateNpcProximity() {
            npcs.forEach(npc => {
                const npcEl = document.getElementById(`npc-${npc.x}-${npc.y}`);
                if (npcEl) {
                    const dist = Math.abs(playerX - npc.x) + Math.abs(playerY - npc.y);
                    if (dist <= 2) {
                        npcEl.classList.add('nearby');
                    } else {
                        npcEl.classList.remove('nearby');
                    }
                }
            });
        }
        
        function enterHouse(house) {
            currentHouse = house;
            currentLocation = 'inside';
            npcs = [];
            
            // Generate interior
            generateInterior(house);
            
            // Position player at entrance
            playerX = 3;
            playerY = 5;
            
            updateCamera();
            updateNpcProximity();
        }
        
        function exitHouse() {
            currentLocation = 'outside';
            npcs = [];
            
            // Restore outside map
            generateMap();
            
            // Re-render house labels
            houses.forEach(h => renderHouseLabel(h));
            
            // Position player in front of house door
            playerX = currentHouse.doorX;
            playerY = currentHouse.doorY + 1;
            currentHouse = null;
            
            updateCamera();
            updateHouseLabels();
        }

        function updateCamera() {
            const screenWidth = 480;
            const screenHeight = 432;
            
            let mapCols, mapRows;
            if (currentLocation === 'inside') {
                mapCols = INTERIOR_MAP[0].length;
                mapRows = INTERIOR_MAP.length;
            } else {
                mapCols = MAP_COLS;
                mapRows = MAP_ROWS;
            }
            
            // Center camera on player
            cameraX = playerX * TILE_SIZE - screenWidth / 2 + TILE_SIZE / 2;
            cameraY = playerY * TILE_SIZE - screenHeight / 2 + TILE_SIZE / 2;
            
            // Clamp camera
            const maxX = mapCols * TILE_SIZE - screenWidth;
            const maxY = mapRows * TILE_SIZE - screenHeight;
            cameraX = Math.max(0, Math.min(cameraX, maxX));
            cameraY = Math.max(0, Math.min(cameraY, maxY));
            
            map.style.transform = `translate(${-cameraX}px, ${-cameraY}px)`;
            
            // Position player relative to camera
            player.style.left = (playerX * TILE_SIZE - cameraX) + 'px';
            player.style.top = (playerY * TILE_SIZE - cameraY) + 'px';
        }

        // ============== INTERACTION ==============
        function checkInteraction() {
            // Check adjacent tiles for NPCs
            const adjacentPositions = [
                {x: playerX, y: playerY - 1},
                {x: playerX, y: playerY + 1},
                {x: playerX - 1, y: playerY},
                {x: playerX + 1, y: playerY}
            ];
            
            for (const pos of adjacentPositions) {
                const npc = npcs.find(n => n.x === pos.x && n.y === pos.y);
                if (npc) {
                    showDialog(npc);
                    return;
                }
            }
        }

        function showDialog(npc) {
            currentNpc = npc;
            gameState = 'dialog';
            dialogBox.style.display = 'block';
            dialogText.innerHTML = `Hola! Soy el encargado de <strong>${npc.name}</strong>.<br>Quieres que te cuente sobre este proyecto?`;
        }

        // ============== BATTLE ==============
        let battleMenuIndex = 0;
        const battleOptions = ['btn-info', 'btn-github', 'btn-stats', 'btn-run'];

        function startBattle(npc) {
            dialogBox.style.display = 'none';
            battleScreen.style.display = 'flex';
            gameState = 'battle';
            battleMenuIndex = 0;
            updateBattleMenuSelection();
            
            document.getElementById('battle-enemy-name').textContent = npc.name.toUpperCase();
            document.getElementById('battle-enemy-level').textContent = `Lang: ${npc.language}`;
        }

        function updateBattleMenuSelection() {
            battleOptions.forEach((id, i) => {
                const btn = document.getElementById(id);
                if (i === battleMenuIndex) {
                    btn.classList.add('selected');
                    btn.textContent = '▶ ' + btn.textContent.substring(2);
                } else {
                    btn.classList.remove('selected');
                    btn.textContent = '  ' + btn.textContent.substring(2);
                }
            });
        }

        function handleBattleNavigation(e) {
            switch(e.code) {
                case 'ArrowUp':
                    battleMenuIndex = (battleMenuIndex - 2 + 4) % 4;
                    updateBattleMenuSelection();
                    break;
                case 'ArrowDown':
                    battleMenuIndex = (battleMenuIndex + 2) % 4;
                    updateBattleMenuSelection();
                    break;
                case 'ArrowLeft':
                    battleMenuIndex = (battleMenuIndex - 1 + 4) % 4;
                    updateBattleMenuSelection();
                    break;
                case 'ArrowRight':
                    battleMenuIndex = (battleMenuIndex + 1) % 4;
                    updateBattleMenuSelection();
                    break;
                case 'Enter':
                case 'Space':
                    document.getElementById(battleOptions[battleMenuIndex]).click();
                    break;
                case 'Escape':
                    closeBattle();
                    break;
            }
        }

        function closeBattle() {
            battleScreen.style.display = 'none';
            gameState = 'walking';
            currentNpc = null;
        }

        // Battle menu buttons
        document.getElementById('btn-info').addEventListener('click', () => {
            showInfo(currentNpc);
        });

        document.getElementById('btn-github').addEventListener('click', () => {
            if (currentNpc) {
                window.open(currentNpc.url, '_blank');
            }
        });

        document.getElementById('btn-stats').addEventListener('click', () => {
            if (currentNpc) {
                alert(`STATS de ${currentNpc.name}\n\nStars: ${currentNpc.stars}\nLenguaje: ${currentNpc.language}\n\n${currentNpc.description}`);
            }
        });

        document.getElementById('btn-run').addEventListener('click', closeBattle);

        // ============== INFO PANEL ==============
        async function showInfo(npc) {
            battleScreen.style.display = 'none';
            infoPanel.style.display = 'flex';
            gameState = 'info';
            
            document.getElementById('info-title').textContent = `${npc.name} - README.md`;
            document.getElementById('info-content').innerHTML = 'Cargando README...';
            
            try {
                const readmeRes = await fetch(`https://api.github.com/repos/MutenRos/${npc.name}/readme`, {
                    headers: { 'Accept': 'application/vnd.github.raw' }
                });
                
                if (readmeRes.ok) {
                    const markdown = await readmeRes.text();
                    document.getElementById('info-content').innerHTML = marked.parse(markdown);
                } else {
                    document.getElementById('info-content').innerHTML = `<p>No se encontró README.md</p><p>${npc.description}</p>`;
                }
            } catch (error) {
                document.getElementById('info-content').innerHTML = `<p>Error al cargar: ${error.message}</p>`;
            }
        }

        function closeInfo() {
            infoPanel.style.display = 'none';
            battleScreen.style.display = 'flex';
            gameState = 'battle';
        }

        document.getElementById('info-back').addEventListener('click', closeInfo);

        // ============== MOBILE CONTROLS ==============
        document.getElementById('btn-up')?.addEventListener('click', () => simulateKey('ArrowUp'));
        document.getElementById('btn-down')?.addEventListener('click', () => simulateKey('ArrowDown'));
        document.getElementById('btn-left')?.addEventListener('click', () => simulateKey('ArrowLeft'));
        document.getElementById('btn-right')?.addEventListener('click', () => simulateKey('ArrowRight'));
        document.getElementById('btn-action')?.addEventListener('click', () => simulateKey('Space'));
        document.getElementById('btn-cancel')?.addEventListener('click', () => simulateKey('Escape'));

        function simulateKey(code) {
            handleKeyDown({ code });
        }

        // Resize handling
        window.addEventListener('resize', updateCamera);
    </script>
</body>
</html>
